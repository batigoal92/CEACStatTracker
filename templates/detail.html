{% extends "base.html" %}
{% block head %}
<h1 class="project-name">{{ case.last_update.status }}</h1>
<h2 class="project-tagline"><b>Case Last Updated: </b>{{ case.last_update.status_date }}<br><b>Case No: </b> {{ case.case_no }}</p></h2>
{% endblock %}
{% block content %}
<h2>Case Info</h2>
<p><b>Case No: </b> {{ case.case_no }}<br>
<b>Location: </b>{{location_str}} ({{ case.location }})<br>
<b>Case Created: </b>{{ case.created_date }}<br>
<b>Case Last Seem: </b>{{ case.last_seem.strftime('%x %X') }}</p>

<form method="POST">
    <input type="hidden" name="act" value="refresh">
    <input type="submit" value="Refresh now" class="btn btn-primary">
</form>

{% if case.expire_date %}
<h2>Auto Refresh Expire</h2>
<p>{{ case.expire_date }}</p>
<form method="POST">
    <input type="hidden" name="act" value="renew">
    <input type="submit" value="Extend" class="btn btn-primary">
</form>
<br>

{% endif %}
<h2>History</h2>
<div class="accordion" id="accordionExample">
    {% for x in record_list %}
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingOne">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
        {{x.status}} / {{x.status_date}}
        </button>
      </h2>
      <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
        <div class="accordion-body">
            <pre class="highlight" style="white-space: pre-wrap; word-wrap:break-word;">{{x.message}}</pre>
        </div>
      </div>
    </div>
    {% endfor %}
</div>

{% if case.expire_date %}
  {% if case.push_channel %}
  <h4>You already have a Wechat account binded with this case, Scan this QR Code to rebind.</h4>
  {% else %}
  <h4>Scan this QR Code by WeChat and follow my service account to receive notifications.</h4>
  {% endif %}
  <div id="qrcode" style="height: 200px; width: 200px;"></div>
  <script type="text/javascript">
  new QRCode(document.getElementById("qrcode"), "{{case.get_qr_code_url()}}");
  </script>
{% endif %}

<h4>Delete my case</h4>
<form method="POST">
<input type="hidden" name="act" value="delete">
<input type="submit" value="Delete my case" class="btn btn-danger" onclick="return confirm('Are you sure?')" >
</form>

{% endblock %}